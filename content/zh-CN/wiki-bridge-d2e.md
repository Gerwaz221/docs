---
id: wiki-bridge-d2e
title: 达尔文->以太坊桥
sidebar_label: D2E桥
---

达尔文->以太坊桥是达尔文至以太坊的去中心化跨链桥，简称D2E桥。D2E桥是达尔文渐进式上线过程中第三阶段开通的一个主要功能，标识着以太坊和达尔文之间的跨链桥双向开通。

D2E桥目前的主要功能，是以去中心的方式，将达尔文主网上的数字资产跨链转移到以太坊上。具体来说，用户在达尔文主网一端将原生资产锁定，于合约中进行安全保管，任何人无法取出。以太坊一端的智能合约实现了观察达尔文网络的超级轻客户端，得以验证用户提交的原生资产锁定证明，并生成等量的ERC20资产。得益于达尔文网络上运行的具有不可逆最终性的GRANDPA协议，以太坊端的超级轻客户端可以在很短的时间内确认并校验用户提交的密码学凭证。

以上过程正好与前期开放的以太坊->达尔文单向桥功能相反，同时，由于是将达尔文原生资产从本链跨链转移至其他链，所以D2E桥也常常被称之为达尔文以太坊反向桥。

# D2E桥的组成

D2E桥主要由以下几部分组成，其整体结构如下图：

![d2e](assets/d2e.png)

## 以太坊上的达尔文超轻客户端

去中心化跨链方案大都会使用轻客户端。所谓轻客户端，就是一个只包含区块链块头的数据结构，它无需存储体积巨大的完整区块链，让用户无需同步完整的区块链即可以安全、分散的方式访问区块链并与之进行交互。

但是对于用智能合约开发，在链上保存源链上所有块头的轻客户端来说，它称不上是轻的。

达尔文通过引入Merkle Mountain Range(MMR)实现了一种按需提交块头的超轻客户端（Super Light Client）。

超轻客户端无需保存每一个块头，只在需要的时候，由桥矿工向其提交所需的块头即可满足数据验证的要求。而桥矿工所提交的块头的正确性，则由D2E Authorities来保证。相较于PoW协议网络，如以太坊到达尔文桥需要引入额外的乐观验证博弈进行确认，超轻客户端花费时间更短、效率更高。未来，当以太坊预编译合约支持Ed25519后，块头的正确性可以由达尔文Granpa Authorities来保证。

## 桥矿工（Relayers）

由于链之间无法直接去访问对方，所以轻客户端的块数据及其MMR摘要提交需要由第三方来完成，这个第三方就是桥矿工。

## D2E Authorities

目前块头的正确性无法通过GRANDPA来保证，这是因为以太坊上验证Ed25519 Justification的gas费非常昂贵。如果直接使用GRANDPA来验证块头，整体的跨链费用也会相应变得非常昂贵。

因此，达尔文采用了一个额外的Authorities集合来完成此事，这个Authorities集合由议会投票产生，包括增加成员或者减少成员，都将由议会来投票决定。D2E Authorities 本质上是对GRANDPA协议的一种模拟，替换了以太坊暂不支持的Ed25519到Ecdsa加密算法。

任何人都可以申请成为Authority，由议会投票决定是否同意其加入，一旦成为Authority，则必须履行Authority职责，在有达尔文块头向以太坊提交前，对验证块头所需要的MMR Root进行Ecdsa签名。

另外，除了对MMR Root签名这个职责外，在Authorities换届变更时，同样需要由原Authorities对新一轮的Authorities集合进行签名，如此才能完成Authorities换届过程。

Authority在完成自己的职责时会得到激励，如果未能在一定时间内（“签名要求事件时的块高 + 100个块”之前）完成自己的职责将会受到惩罚，申请时所质押的RING将被全部被系统扣除。

## 达尔文上的Ethereum Backing模块

Ethereum Backing是为达尔文资产在以太坊上发行进行背书的模块。简单来说，就是转移到以太坊上的资产都需要被锁定到这个模块进行安全保管。任何人无法从其中提取资产，除非用户提供在以太坊端的资产销毁证明，通过模块的超级轻客户端验证确认资产销毁确实发生后，才能取出相应数量的资产，这个过程也就是正向桥的赎回协议，即用户在以太坊端将资产转移回达尔文网络。

所以，当用户想要通过D2E桥跨链转账到以太坊时，首先要做的就是去锁定资产，虫洞应用将帮助你完成这一步，并协助收集相应的加密学锁定证明。

# 改进规划

Darwinia和以太坊之间的去中心化跨链转接桥不仅存在设计上的难度，同时还存在一些工程上的挑战。例如，目前的GRANDPA Justification Proof里包含Ed25519的密码学签名，但是目前的以太坊智能合约尚不支持Ed25519的验签预编译合约，如果直接用智能合约实现签名算法，则面临Gas费用过高的问题。虽然已经有相关的改进提案，例如[EIP665](https://eips.ethereum.org/EIPS/eip-665)，但目前仍然是Draft状态，还没有被实现。为了解决这些现实的工程问题，我们创新设计了一套GRANDPA Authorities代理机制，通过在Darwinia Runtime中嵌入这套代理模块，成功实现用一组Ethereum standard secp256k1 ECDSA加密签名来代理Ed25519的签名。

D2E桥不会止步于此，为了达到更加完备和健壮的状态，还将进行一系列改进。

## 采用BEEFY协议
在EIP-665未被以太坊采纳前，BEEFY将会是一个更为通用的方式。

Parity正在为Substrate开发一个名为BEEFY (Bridge Efficiency Enabling Finality Yielder)的GRANDPA附属协议，此协议基于GRANDPA Finality，其目的是为了让基于Substrate的链更高效地接入非Substrate区块链。目前的主要接入对象就是以太坊。

此协议在GRANDPA Finality之上，运行另一轮BFT协议，其中每个Validator将对同一件事进行投票。 即，每个Validator将对GRANDPA最终确定的最新区块的MMR Root进行投票。对以太坊来说，就是采用Ethereum standard secp256k1 ECDSA算法进行签名。

D2E桥计划未来在BEEFY成熟后，使用BEEFY结合GRANDPA来实现轻客户端。

## 在以太坊端的超轻客户端中直接使用GRANDPA Justification进行区块验证

如果EIP-665被以太坊正式采纳，那么在以太坊智能合约中使用GRANDPA Justification验证区块的费用将会大幅下降，届时可以用GRANDPA Authorities替代Authorities进行区块的验证。

## 通过Merkle树来减少公钥和signatures的数据量

## 通用化及框架化

## 支持任意通证的注册及跨链
